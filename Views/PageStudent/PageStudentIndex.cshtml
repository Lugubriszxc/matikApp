<!DOCTYPE html>
<html lang="en">
<header>
    
</header>
<body>
    <nav class="navbar bg-body-tertiary fixed-top">
    <div class="container-fluid">
        @* <a class="navbar-brand text-warning" href="#">M A T I K</a> *@
        <button class="navbar-toggler me-auto btn-black" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class=""><i class="fa-solid fa-bars text-warning"></i></span>
            
        </button>
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
        <div class="offcanvas-header">
            <center><h5 class="offcanvas-title studentName" id="offcanvasNavbarLabel">Student X</h5></center>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-dark" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                User Settings
                </a>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-lg-start">
                <li class="dropdown-item"><a class="nav-link btnUpdate">Change detail</a></li>
                <li class="dropdown-item"><a class="nav-link btnChangePass">Change password</a></li>
                </ul>
            </li>

            <br><br><br><br><br>
            <li class="nav-item">
                <a class="btn btn-warning" id="btnSignout">Signout</a>
            </li>
            </ul>
        </div>
        </div>
    </div>
    </nav>

    <br><br>
    <div><h4>Welcome, <span class="studentName"></span></h4></div>
    <hr>

    <!-- THIS IS FOR THE CONTENT OF THE PAGE-->
    <center><h1></h1></center>

    @Html.Partial("StudentChangePass")

    @* @Html.Partial("PageInstructorUpdate")
    @Html.Partial("InstructorChangePass")
    @Html.Partial("PageInstructorTable") *@
    <div id="contentContainer">
        <!-- Existing content or future dynamic content goes here -->
    </div>
</body>
</html>

<script>
    $(document).ready(function(){
        margin();

        function margin(){
            $(".page-content").removeClass();
            $(".container-fluid.shared").removeClass();
            @* $(".bods").removeClass(); *@
        }
    });
</script>

<style>
    .navbar.shared{
        display: none;
    }

    .bods
    {
        color: white;
        background-color: white;
    }

    .btn-black {
    color: #000;
    background-color: maroon; /* Add this line to set the background color */
    border-color: gold; /* Add this line to set the border color */
    }

    @* body
    {
        color: black;
        background-color: black;
    } *@
</style>

<script>
    $(document).ready(function(){

        var storedUserAuth = sessionStorage.getItem('userauth');
        var userAuth = JSON.parse(storedUserAuth);

		if(userAuth === null)
        {
            window.location.href = "/Authorization/SigninStudent";
        }
        else if(userAuth.userType !== 'student')
        {
            if(userAuth.userType === 'admin')
            {
                window.location.href = "/Home/Index";
            }
            else if(userAuth.userType === 'instructor')
            {
                window.location.href = "/PageInstructor/PageInstructorIndex";
            }
        }

        var Subjects = {};
        var Rooms = {};
        var Sections = {};
        var Timeslots = {};
        var AcadYears = {};

        loadStudentDetail();
        loadList();
        var selectedStudent;

        function loadStudentDetail()
        {
            //LOAD THE INSTRUCTOR DETAILS 
            $.ajax({
            url: "../api/pagestudentapi/loadUserDetail",
            type: "POST",
            data:
            {
                studentId : userAuth.id,
            },
            }).done(function(result){
                
                if(result != null)
                {
                    selectedStudent = result;
                    //console.log(result.instructorFname);
                    $('.studentName').text(result.studentFname + " " + result.studentLname);
                }
            })
        }

        $(".btnChangePass").click((e) => {
            $("#modalChangePass").modal("toggle");
        });

        //after clicking change password
        $("#passChange").click(function(){

            var currentPass = $("#inputCurrentPass").val();
            var newPass = $("#inputNewPass").val();
            var confirmPass = $("#inputConfirmPass").val();

            if(currentPass == "" || newPass == "" || confirmPass == "")
            {
                alertError("Complete the field first!");
            }
            else if(newPass !== confirmPass)
            {
                alertError("Password does not match!");
            }
            else
            {
                alertConfirmChange();
            }
        });

        function proceedChangePass()
        {

            var currentPass = $("#inputCurrentPass").val();
            var newPass = $("#inputNewPass").val();
            var confirmPass = $("#inputConfirmPass").val();

            $.ajax({
            url: "../api/authorizationapi/changeUserPass",
            type: "POST",
            data:
            {
                auth : userAuth,
                newP : newPass,
                currentP : currentPass,
            },
            })
            .done(function(result){

                if(result == "Invalid")
                {
                    alertError("Invalid password.");
                }
                else if(result == "Confirm")
                {
                    $("#passChangeForm")[0].reset();
                    $("#modalChangePass").modal("toggle");
                    alertSuccess();
                    loadStudentDetail();
                }
            });
        }


        //UPDATE STUDENT
        @* $(".btnUpdate").click((e) => {
            $("#modalStudentUpdate").modal("toggle");

            oFormObject = document.forms["updateStudentForm"];
            initForm(oFormObject, selectedStudent);
        }); *@


        $("#btnSignout").click((e) =>{
            confirmLogout();
        });

        function proceedLogout()
        {
            sessionStorage.clear();
            window.location.href = "/Authorization/SigninStudent";
        }

        function loadList()
        {
            $.ajax("../api/adminapi/getSubjects").done(function(result){
                Subjects = result;
                console.log(result);
                //populateTable();
                //To avoid unexplainable bugs, we called populateTable here. After calling this from the api
                $.ajax("../api/adminapi/getSections").done(function(result){
                    Sections = result;
                    console.log(result);
                    //populateTable();

                    $.ajax("../api/adminapi/getRooms").done(function(result){
                        Rooms = result;
                        console.log(result);
                        //populateTable();

                        $.ajax("../api/adminapi/getTimeSlots").done(function(result){
                            Timeslots = result;
                            console.log(result);
                            //populateTable();
                            $.ajax("../api/adminapi/getAcademicYear").done(function(result){
                                AcadYears = result;
                                console.log(result);
                            });
                        });
                    });
                });
            });
        }



        function confirmLogout()
        {
            Swal.fire({
                title: 'Are you sure you want to logout?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes',
                confirmButtonColor: '#3085d6'
            }).then((result) => {
                if(result.isConfirmed){
                    proceedLogout();
                }
            })
        }

        //display confirm change password
        function alertConfirmChange()
        {
            Swal.fire({
                title: 'Do you really want to change your password?',
                showCancelButton: true,
                confirmButtonText: 'Save',
            }).then((result) => {
                if(result.isConfirmed){
                    proceedChangePass();
                }
            })
        }

        //display success action
        function alertSuccess()
        {
            Swal.fire({
                icon: 'success',
                title: 'Your work has been saved', 
                showConfirmButton: false,
                timer: 1500
            })
        }

        function alertError(message)
        {
            Swal.fire({
                icon: 'error',
                title: 'Error occured',
                text: message,
            })
        }

        //end of document.ready
    });
</script>